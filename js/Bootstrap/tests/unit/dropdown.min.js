$(function(){QUnit.module("dropdowns plugin");QUnit.test("should be defined on jquery object",function(a){a.expect(1);a.ok($(document.body).dropdown,"dropdown method is defined")});QUnit.module("dropdowns",{beforeEach:function(){$.fn.bootstrapDropdown=$.fn.dropdown.noConflict()},afterEach:function(){$.fn.dropdown=$.fn.bootstrapDropdown;delete $.fn.bootstrapDropdown}});QUnit.test("should provide no conflict",function(a){a.expect(1);a.strictEqual($.fn.dropdown,undefined,"dropdown was set back to undefined (org value)")});QUnit.test("should return jquery collection containing the element",function(a){a.expect(2);var b=$("<div/>");var c=b.bootstrapDropdown();a.ok(c instanceof $,"returns jquery collection");a.strictEqual(c[0],b[0],"collection contains element")});QUnit.test("should not open dropdown if target is disabled via attribute",function(a){a.expect(1);var b='<ul class="tabs"><li class="dropdown"><button disabled href="#" class="btn dropdown-toggle" data-toggle="dropdown">Dropdown</button><ul class="dropdown-menu"><li><a href="#">Secondary link</a></li><li><a href="#">Something else here</a></li><li class="divider"/><li><a href="#">Another link</a></li></ul></li></ul>';var c=$(b).find('[data-toggle="dropdown"]').bootstrapDropdown().trigger("click");a.ok(!c.parent(".dropdown").hasClass("open"),'"open" class added on click')});QUnit.test('should set aria-expanded="true" on target when dropdown menu is shown',function(a){a.expect(1);var b='<ul class="tabs"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false">Dropdown</a><ul class="dropdown-menu"><li><a href="#">Secondary link</a></li><li><a href="#">Something else here</a></li><li class="divider"/><li><a href="#">Another link</a></li></ul></li></ul>';var c=$(b).find('[data-toggle="dropdown"]').bootstrapDropdown().trigger("click");a.strictEqual(c.attr("aria-expanded"),"true",'aria-expanded is set to string "true" on click')});QUnit.test('should set aria-expanded="false" on target when dropdown menu is hidden',function(b){b.expect(1);var a=b.async();var c='<ul class="tabs"><li class="dropdown"><a href="#" class="dropdown-toggle" aria-expanded="false" data-toggle="dropdown">Dropdown</a><ul class="dropdown-menu"><li><a href="#">Secondary link</a></li><li><a href="#">Something else here</a></li><li class="divider"/><li><a href="#">Another link</a></li></ul></li></ul>';var d=$(c).appendTo("#qunit-fixture").find('[data-toggle="dropdown"]').bootstrapDropdown();d.parent(".dropdown").on("hidden.bs.dropdown",function(){b.strictEqual(d.attr("aria-expanded"),"false",'aria-expanded is set to string "false" on hide');a()});d.trigger("click");$(document.body).trigger("click")});QUnit.test("should not open dropdown if target is disabled via class",function(a){a.expect(1);var b='<ul class="tabs"><li class="dropdown"><button href="#" class="btn dropdown-toggle disabled" data-toggle="dropdown">Dropdown</button><ul class="dropdown-menu"><li><a href="#">Secondary link</a></li><li><a href="#">Something else here</a></li><li class="divider"/><li><a href="#">Another link</a></li></ul></li></ul>';var c=$(b).find('[data-toggle="dropdown"]').bootstrapDropdown().trigger("click");a.ok(!c.parent(".dropdown").hasClass("open"),'"open" class added on click')});QUnit.test("should add class open to menu if clicked",function(a){a.expect(1);var b='<ul class="tabs"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown</a><ul class="dropdown-menu"><li><a href="#">Secondary link</a></li><li><a href="#">Something else here</a></li><li class="divider"/><li><a href="#">Another link</a></li></ul></li></ul>';var c=$(b).find('[data-toggle="dropdown"]').bootstrapDropdown().trigger("click");a.ok(c.parent(".dropdown").hasClass("open"),'"open" class added on click')});QUnit.test("should test if element has a # before assuming it's a selector",function(a){a.expect(1);var b='<ul class="tabs"><li class="dropdown"><a href="/foo/" class="dropdown-toggle" data-toggle="dropdown">Dropdown</a><ul class="dropdown-menu"><li><a href="#">Secondary link</a></li><li><a href="#">Something else here</a></li><li class="divider"/><li><a href="#">Another link</a></li></ul></li></ul>';var c=$(b).find('[data-toggle="dropdown"]').bootstrapDropdown().trigger("click");a.ok(c.parent(".dropdown").hasClass("open"),'"open" class added on click')});QUnit.test('should remove "open" class if body is clicked',function(a){a.expect(2);var b='<ul class="tabs"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown</a><ul class="dropdown-menu"><li><a href="#">Secondary link</a></li><li><a href="#">Something else here</a></li><li class="divider"/><li><a href="#">Another link</a></li></ul></li></ul>';var c=$(b).appendTo("#qunit-fixture").find('[data-toggle="dropdown"]').bootstrapDropdown().trigger("click");a.ok(c.parent(".dropdown").hasClass("open"),'"open" class added on click');$(document.body).trigger("click");a.ok(!c.parent(".dropdown").hasClass("open"),'"open" class removed')});QUnit.test('should remove "open" class if body is clicked, with multiple dropdowns',function(a){a.expect(7);var c='<ul class="nav"><li><a href="#menu1">Menu 1</a></li><li class="dropdown" id="testmenu"><a class="dropdown-toggle" data-toggle="dropdown" href="#testmenu">Test menu <span class="caret"/></a><ul class="dropdown-menu"><li><a href="#sub1">Submenu 1</a></li></ul></li></ul><div class="btn-group"><button class="btn">Actions</button><button class="btn dropdown-toggle" data-toggle="dropdown"><span class="caret"/></button><ul class="dropdown-menu"><li><a href="#">Action 1</a></li></ul></div>';var e=$(c).appendTo("#qunit-fixture").find('[data-toggle="dropdown"]');var d=e.first();var b=e.last();a.strictEqual(e.length,2,"two dropdowns");d.trigger("click");a.strictEqual(d.parents(".open").length,1,'"open" class added on click');a.strictEqual($("#qunit-fixture .open").length,1,"only one dropdown is open");$(document.body).trigger("click");a.strictEqual($("#qunit-fixture .open").length,0,'"open" class removed');b.trigger("click");a.strictEqual(b.parent(".open").length,1,'"open" class added on click');a.strictEqual($("#qunit-fixture .open").length,1,"only one dropdown is open");$(document.body).trigger("click");a.strictEqual($("#qunit-fixture .open").length,0,'"open" class removed')});QUnit.test("should fire show and hide event",function(b){b.expect(2);var c='<ul class="tabs"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown</a><ul class="dropdown-menu"><li><a href="#">Secondary link</a></li><li><a href="#">Something else here</a></li><li class="divider"/><li><a href="#">Another link</a></li></ul></li></ul>';var d=$(c).appendTo("#qunit-fixture").find('[data-toggle="dropdown"]').bootstrapDropdown();var a=b.async();d.parent(".dropdown").on("show.bs.dropdown",function(){b.ok(true,"show was fired")}).on("hide.bs.dropdown",function(){b.ok(true,"hide was fired");a()});d.trigger("click");$(document.body).trigger("click")});QUnit.test("should fire shown and hidden event",function(b){b.expect(2);var c='<ul class="tabs"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown</a><ul class="dropdown-menu"><li><a href="#">Secondary link</a></li><li><a href="#">Something else here</a></li><li class="divider"/><li><a href="#">Another link</a></li></ul></li></ul>';var d=$(c).appendTo("#qunit-fixture").find('[data-toggle="dropdown"]').bootstrapDropdown();var a=b.async();d.parent(".dropdown").on("shown.bs.dropdown",function(){b.ok(true,"shown was fired")}).on("hidden.bs.dropdown",function(){b.ok(true,"hidden was fired");a()});d.trigger("click");$(document.body).trigger("click")});QUnit.test("should fire shown and hidden event with a relatedTarget",function(b){b.expect(2);var c='<ul class="tabs"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown</a><ul class="dropdown-menu"><li><a href="#">Secondary link</a></li><li><a href="#">Something else here</a></li><li class="divider"/><li><a href="#">Another link</a></li></ul></li></ul>';var d=$(c).appendTo("#qunit-fixture").find('[data-toggle="dropdown"]').bootstrapDropdown();var a=b.async();d.parent(".dropdown").on("hidden.bs.dropdown",function(f){b.strictEqual(f.relatedTarget,d[0]);a()}).on("shown.bs.dropdown",function(f){b.strictEqual(f.relatedTarget,d[0]);$(document.body).trigger("click")});d.trigger("click")});QUnit.test("should ignore keyboard events within <input>s and <textarea>s",function(b){b.expect(3);var a=b.async();var c='<ul class="tabs"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown</a><ul class="dropdown-menu"><li><a href="#">Secondary link</a></li><li><a href="#">Something else here</a></li><li class="divider"/><li><a href="#">Another link</a></li><li><input type="text" id="input"></li><li><textarea id="textarea"/></li></ul></li></ul>';var d=$(c).appendTo("#qunit-fixture").find('[data-toggle="dropdown"]').bootstrapDropdown();var f=$("#input");var e=$("#textarea");d.parent(".dropdown").on("shown.bs.dropdown",function(){b.ok(true,"shown was fired");f.trigger("focus").trigger($.Event("keydown",{which:38}));b.ok($(document.activeElement).is(f),"input still focused");e.trigger("focus").trigger($.Event("keydown",{which:38}));b.ok($(document.activeElement).is(e),"textarea still focused");a()});d.trigger("click")});QUnit.test("should skip disabled element when using keyboard navigation",function(a){a.expect(1);var b='<ul class="tabs"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown</a><ul class="dropdown-menu"><li class="disabled"><a href="#">Disabled link</a></li><li><a href="#">Another link</a></li></ul></li></ul>';var c=$(b).appendTo("#qunit-fixture").find('[data-toggle="dropdown"]').bootstrapDropdown().trigger("click");c.trigger($.Event("keydown",{which:40}));c.trigger($.Event("keydown",{which:40}));a.ok(!$(document.activeElement).parent().is(".disabled"),".disabled is not focused")});QUnit.test("should not close the dropdown if the user clicks on a text field",function(a){a.expect(1);var b='<div class="btn-group"><button type="button" data-toggle="dropdown">Dropdown</button><ul class="dropdown-menu"><li><input id="textField" type="text" /></li></ul></div>';var c=$(b).appendTo("#qunit-fixture").find('[data-toggle="dropdown"]').bootstrapDropdown().trigger("click");$("#textField").trigger("click");a.ok(c.parent(".btn-group").hasClass("open"),"dropdown menu is open")});QUnit.test("should not close the dropdown if the user clicks on a textarea",function(a){a.expect(1);var b='<div class="btn-group"><button type="button" data-toggle="dropdown">Dropdown</button><ul class="dropdown-menu"><li><textarea id="textArea"></textarea></li></ul></div>';var c=$(b).appendTo("#qunit-fixture").find('[data-toggle="dropdown"]').bootstrapDropdown().trigger("click");$("#textArea").trigger("click");a.ok(c.parent(".btn-group").hasClass("open"),"dropdown menu is open")})});